<!-- <ion-header>
  <ion-toolbar>
    <ion-title>Session Result</ion-title>
  </ion-toolbar>
</ion-header> -->



<ion-content class="result-bg">

  <ion-spinner *ngIf="loading" class="center-spinner"></ion-spinner>

  <div *ngIf="!loading" class="result-wrapper">

    <!-- SCORE SUMMARY -->
    <div class="summary-sheet">
      <div class="score-main">
        {{ averageScore }}<span>/10</span>
      </div>
      <div class="trophy" [class.show]="showTrophy">
  ğŸ†
</div>
      <div class="score-sub">Average Score</div>
    </div>

    <!-- QUESTION RESULTS -->
<div
  *ngFor="let r of results; let i = index"
  class="result-sheet"
  [class.wrong]="r.score < 7"
  [class.correct]="r.score >= 7"
  [class.expanded]="expandedIndex === i"
  (click)="toggleExpand(i)">

  <!-- HEADER -->
  <div class="sheet-header">
    <div class="question">
      {{ r.question }}
    </div>

    <div class="tags">
      <span class="tag topic">{{ r.topic }}</span>
      <span class="tag best" *ngIf="i === bestIndex && results.length > 1">ğŸ† Best</span>
      <span class="tag weak" *ngIf="i === weakestIndex && results.length > 1">â­ Weak</span>
    </div>
<div class="sheet-preview">
  <span>View details</span>
</div>
    <button
      *ngIf="r.score < 10"
      class="explain-btn"
      (click)="explainWrong(r, i); $event.stopPropagation()"
      [disabled]="explainingIndex === i">

      <ion-spinner *ngIf="explainingIndex === i" name="dots"></ion-spinner>
      <span *ngIf="explainingIndex !== i">Help me understand</span>
      <span *ngIf="explainingIndex === i">Thinkingâ€¦</span>
    </button>

  </div>

  <!-- STATUS -->
  <div class="status">
    <span class="status-badge success" *ngIf="r.score >= 7">Correct</span>
    <span class="status-badge danger" *ngIf="r.score < 7">Needs Improvement</span>
    <span class="score">{{ r.score }}/10</span>
  </div>

  <!-- COLLAPSIBLE BODY -->
  <div class="sheet-body">

    <div class="answers">
      <div class="answer your">
        <label>Your Answer</label>
        <p>{{ r.userAnswer || 'N/A' }}</p>
      </div>

      <div class="answer correct">
        <label>Correct Answer</label>
        <p>{{ r.correctAnswer || r.improvedAnswer }}</p>
      </div>
    </div>

    <div class="feedback">
      {{ r.feedback }}
    </div>



  </div>

</div>


  </div>
</ion-content>
<ion-footer>
      <ion-button expand="block" class="dashboard-btn" routerLink="/tabs/dashboard">
      Go to Dashboard
    </ion-button>
</ion-footer>